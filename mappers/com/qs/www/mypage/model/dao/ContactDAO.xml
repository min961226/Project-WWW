<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ContactDAO">
	<resultMap type="com.qs.www.mypage.model.dto.ContactDTO" id="contactResultMap">
		<id property="code" column="DEPT_CODE"/>
		<result property="name" column="NAME"/>
		<result property="deptname" column="DEPT_NAME"/>
		<result property="phone" column="PHONE"/>
		
	</resultMap>
	
	<select id="selectAllContactList" resultMap="contactResultMap">
        SELECT /* com.qs.www.mypage.model.dao.ContactDAO#selectAllContactList() */
               A.DEPT_CODE
             , A.DEPT_NAME  
             , D.NAME
             , D.PHONE
         	FROM TBL_DEPARTMENT A
         	LEFT JOIN TBL_MEMBER D ON(A.DEPT_CODE = D.DEPT_CODE)
	</select>
	
	<select id="selectBoardList" resultMap="contactResultMap">
         SELECT 
                C.RNUM
        	  , C.DEPT_NAME
              , C.DEPT_CALL_NUMBER
              , C.DEPT_CODE
          FROM (SELECT ROWNUM RNUM
          			 , B.DEPT_NAME
                     , B.DEPT_CALL_NUMBER
		             , B.DEPT_CODE
                  FROM (SELECT A.DEPT_NAME
             				 , A.DEPT_CALL_NUMBER
				             , A.DEPT_CODE
                           FROM TBL_DEPARTMENT A
    					<where>
							<if test="searchCondition == 'name'">
	           				    D.NAME LIKE '%' || #{ searchValue } || '%'	
							</if>
							<if test="searchCondition == 'deptname'">
	           				   A.DEPT_NAME '%' || #{ searchValue } || '%' 	
							</if>
							<if test="searchCondition == 'phone'">
	           				   D.PHONE LIKE '%' || #{ searchValue } || '%' 	
							</if>
    					</where>
                         ORDER BY A.DEPT_CODE DESC
                        ) B
                  <![CDATA[
                  WHERE ROWNUM <= #{ endRow }
                  ]]>
               ) C
         WHERE C.RNUM >= #{ startRow }     
	</select>
	

	
		<select id="selectAllCount" resultType="_int" parameterType="hashmap">
        SELECT /* com.qs.www.mypage.model.dao.ContactDAO#selectAllCount() */
               COUNT(*)
          FROM TBL_DEPARTMENT A
          LEFT JOIN TBL_MEMBER D ON(A.DEPT_CODE = D.DEPT_CODE)
    	<where>
			<if test="searchCondition == 'name'">
	           D.NAME LIKE '%' || #{ searchValue } || '%'	
			</if>
			<if test="searchCondition == 'deptname'">
	           A.DEPT_NAME LIKE '%' || #{ searchValue } || '%' 	
			</if>
			<if test="searchCondition == 'phone'">
	           D.PHONE LIKE '%' || #{ searchValue } || '%' 	
			</if>

            
    	</where>
	</select>
	

	
</mapper>