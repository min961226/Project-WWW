<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MngHolidayDAO">
    <resultMap type="com.qs.www.schedule.model.dto.ReportDTO"
		id="reportResultMap">
		<result property="reportNo" column="REPORT_NO" />
		<result property="reportDate" column="REPORT_DATE" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="documentNo" column="DOCUMENT_NO" />
		<result property="reportNote" column="REPORT_NOTE" />
		<result property="reportStatus" column="REPORT_STATUS" />
		<result property="lineName" column="LINE_NAME" />
		<result property="reportTitle" column="REPORT_TITLE" />
		<result property="memberName" column="NAME" />
	</resultMap>
    <resultMap type="com.qs.www.schedule.model.dto.HolidayUseInfoDTO"
		id="holidayUseInfoResult">
		<result property="holidayLogNo" column="HOLIDAY_LOG_NO" />
		<result property="holidayStartDay" column="HOLIDAY_START_DAY" />
		<result property="holidayStartDayAllday" column="HOLIDAY_START_DAY_ALLDAY" />
		<result property="holidayEndDay" column="HOLIDAY_END_DAY" />
		<result property="holidayEndDayAllday" column="HOLIDAY_END_DAY_ALLDAY" />
		<result property="holidayReportNo" column="HOLIDAY_REPORT_NO" />
	</resultMap>
    <resultMap type="com.qs.www.mng.holiday.model.dto.HolidayRuleDTO"
		id="holidayRuleResult">
		<result property="ruleCode" column="RULE_CODE" />
		<result property="workPeriod" column="WORK_PERIOD" />
		<result property="dayNumber" column="DAY_NUMBER" />
		<result property="FiscalStateDate" column="FISCAL_START_DATE" />
	</resultMap>	
	<select id="selectHolidayAPPCount" resultType="_int" parameterType="hashmap">
        SELECT /*com.qs.www.mng.holiday.model.dao.MngHolidayDAO#selectHolidayAPPCount"()*/
               COUNT(*)
           FROM TBL_REPORT A
      LEFT JOIN TBL_MEMBER D ON(A.MEMBER_NO = D.MEMBER_NO)
      LEFT JOIN TBL_DOCUMENT_FORM E ON(A.DOCUMENT_NO = E.DOCUMENT_NO)
    		    <where>
    		        <if test="searchCondition == 'name'">
    		            D.NAME LIKE '%' || #{ searchValue } || '%'
    		        </if>
					<if test="searchCondition == 'title'">
	           			A.REPORT_TITLE LIKE '%' || #{ searchValue } || '%' 	
					</if>
					<if test="searchCondition == 'body'">
	           			A.REPORT_NOTE LIKE '%' || #{ searchValue } || '%' 	
					</if>
					<if test="searchCondition == 'docCategory'">
	           			F.DOCUMENT_NAME LIKE '%' || #{ searchValue } || '%' 	
					</if>
	       			AND A.DOCUMENT_NO = 6
    			</where>
    			ORDER BY A.REPORT_NO DESC
	</select>
	<select id="selectHolidayAPP" resultMap="reportResultMap">
    SELECT /* com.qs.www.mng.holiday.model.dao.MngHolidayDAO#selectHolidayAPP()*/ 
           C.*
      FROM (SELECT ROWNUM RNUM
          		, B.*
          	FROM (SELECT
          	             A.*
          	           , D.NAME
          	        FROM TBL_REPORT A
          	   LEFT JOIN TBL_MEMBER D ON(A.MEMBER_NO = D.MEMBER_NO)
          	   LEFT JOIN TBL_DOCUMENT_FORM E ON(A.DOCUMENT_NO = E.DOCUMENT_NO)
    		    <where>
    		        <if test="searchCondition == 'name'">
    		            D.NAME LIKE '%' || #{ searchValue } || '%'
    		        </if>
					<if test="searchCondition == 'title'">
	           			A.REPORT_TITLE LIKE '%' || #{ searchValue } || '%' 	
					</if>
					<if test="searchCondition == 'body'">
	           			A.REPORT_NOTE LIKE '%' || #{ searchValue } || '%' 	
					</if>
					<if test="searchCondition == 'docCategory'">
	           			F.DOCUMENT_NAME LIKE '%' || #{ searchValue } || '%' 	
					</if>
	       			AND A.DOCUMENT_NO = 6
    			</where>
    			ORDER BY A.REPORT_NO DESC
                ) B
          <![CDATA[
          WHERE ROWNUM <= #{ endRow }
          ]]>
        ) C
   WHERE C.RNUM >= #{ startRow } 
	</select>
	<select id="selectHolidayLogNum" resultType="_int">
        SELECT /*com.qs.www.mng.holiday.model.dao.MngHolidayDAO#selectHolidayLogNum"()*/
               A.HOLIDAY_LOG_NO
         FROM TBL_HOLIDAY_USE_INFO A
        WHERE A.HOLIDAY_REPORT_NO = #{ reportNo }
	</select>
	<update id="cancleSelectedReport">
		UPDATE /* com.qs.www.mng.holiday.model.dao.MngHolidayDAO#cancleSelectedReport()*/
		       TBL_REPORT A
		   SET A.REPORT_STATUS = '취소'
		 WHERE A.REPORT_NO = #{ reportNo }
	</update>
	<delete id="deleteHolidayUseInfo">
		DELETE /* com.qs.www.mng.holiday.model.dao.MngHolidayDAO#deleteHolidayUseInfo()*/
		  FROM TBL_HOLIDAY_USE_INFO A
		 WHERE A.HOLIDAY_LOG_NO = #{ logNo }
	</delete>
	<delete id="deleteHolidayLog">
		DELETE /* com.qs.www.mng.holiday.model.dao.MngHolidayDAO#deleteHolidayLog()*/
		  FROM TBL_MEMBER_HOLIDAY_LOG A
		 WHERE A.HOLIDAY_LOG_NO = #{ logNo }
	</delete>
	<select id="selectDuringDate" resultType="String">
        SELECT /*com.qs.www.mng.holiday.model.dao.MngHolidayDAO#selectHolidayLogNum"()*/
               A.HOLIDAY_DURING_DATE
         FROM TBL_MEMBER_HOLIDAY_LOG A
        WHERE A.HOLIDAY_LOG_NO = #{ logNo }
	</select>
	<select id="selectHolidayRule" resultMap="holidayRuleResult">
        SELECT /*com.qs.www.mng.holiday.model.dao.MngHolidayDAO#selectHolidayRule"()*/
               A.*
         FROM TBL_HOLIDAY_RULE A
	</select>
</mapper>
