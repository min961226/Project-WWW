<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MngWelfareDAO">

<resultMap type="com.qs.www.mng.welfare.model.dto.ItemDTO" id="itemListResultMap">
		<result property="logNo" column="LOG_NO" />
		<result property="itemNo" column="ITEM_NO" />
		<result property="itemCategory" column="ITEM_CATEGORY" />
		<result property="itemName" column="ITEM_NAME" />
		<result property="reservationStatus" column="RESERVATION_STATUS" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="reservationDate" column="RESERVATION_DATE" />
		<result property="returnDate" column="RETURN_DATE" />
		<result property="returnDueDate" column="RETURN_DUE_DATE" />
	</resultMap>

<select id="selectNextItemNo" resultType="_int">
		SELECT /* com.qs.www.mngwelfare.model.dao.WelfareDAO#selectNextItemNo() */
		       LAST_NUMBER
		  FROM USER_SEQUENCES
		 WHERE SEQUENCE_NAME = 'SEQ_LAPTOP_ITEM_NO'
	</select>
	
	<insert id="insertItem" parameterType="com.qs.www.mng.welfare.model.dto.ItemDTO">

		INSERT /* com.qs.www.mngwelfare.model.dao.MngWelfareDAO#insertItem() */
	  	  INTO TBL_LAPTOP A
			  (
	  		    A.ITEM_NO
			  , A.ITEM_CATEGORY
			  , A.ITEM_NAME
			  , A.RESERVATION_STATUS
			  , A.DELETE_YN
			  )
			  VALUES
			  (
	  		    SEQ_LAPTOP_ITEM_NO.NEXTVAL
			  , #{ itemCategory }
			  , #{ itemName }
			  , DEFAULT
			  , DEFAULT
			  )
	</insert>
	
	<update id="deleteItem" parameterType="java.util.List">
		UPDATE TBL_LAPTOP
		   SET DELETE_YN = 'Y'
			<where>
				<foreach collection="list" item="item" open="" close="" separator="OR">
		 			(ITEM_NO = #{item.itemNo})
				</foreach>
			</where>
	</update>
	
	<select id="selectOneItemLog" resultMap="itemListResultMap">
		SELECT
       		   LOG.LOG_NO                  
     		 , LAP.ITEM_NO
     		 , LAP.ITEM_CATEGORY
     		 , LAP.ITEM_NAME
     		 , LAP.RESERVATION_STATUS
     		 , LOG.MEMBER_NO
     		 , LOG.RESERVATION_DATE
     		 , LOG.RETURN_DATE
     		 , LOG.RETURN_DUE_DATE
  		  FROM TBL_LAPTOP_LOG LOG
  		  LEFT JOIN TBL_LAPTOP LAP ON (LOG.ITEM_NO = LAP.ITEM_NO)
 		 WHERE RETURN_DATE IS NULL
   		   AND RESERVATION_STATUS = '대여중'
   		   AND LAP.ITEM_NO = #{ itemNo }
	</select>
	
	<select id="selectAllItemLog" resultMap="itemListResultMap">
		SELECT
       		   LOG.LOG_NO                  
     		 , LAP.ITEM_NO
     		 , LAP.ITEM_CATEGORY
     		 , LAP.ITEM_NAME
     		 , LOG.MEMBER_NO
     		 , LOG.RESERVATION_DATE
     		 , LOG.RETURN_DATE
			 , LOG.RETURN_DUE_DATE
  		  FROM TBL_LAPTOP_LOG LOG
  		  LEFT JOIN TBL_LAPTOP LAP ON (LOG.ITEM_NO = LAP.ITEM_NO)
 		 WHERE RETURN_DATE IS NOT NULL
   		   AND LAP.ITEM_NO = #{ itemNo }
   	</select>
   	
   	<update id="updateReturnItem" parameterType="com.qs.www.mng.welfare.model.dto.ItemDTO">
		UPDATE TBL_LAPTOP_LOG
		   SET RETURN_DATE = #{ returnDate }
		 WHERE LOG_NO = #{ logNo }
	</update>
	
	<update id="updateChangeStatus" >
		UPDATE TBL_LAPTOP
		   SET RESERVATION_STATUS = DEFAULT
		 WHERE ITEM_NO = #{ itemNo }
	</update>
   		   
</mapper>